---
title: "DATA205 EDA"
output: html_document
---

## Load data
### Read in two dataMontgomery datasets: "Moderately Priced Dwelling Units" and "Housing Licensing and Registration"
### Install necessary packages for data cleaning, wrangling, and visualizing: tidyverse and ggplot2.

```{r}
MPDU <- read.csv("https://data.montgomerycountymd.gov/api/views/pbh5-g4e5/rows.csv?accessType=DOWNLOAD")
HLR <- read.csv("https://data.montgomerycountymd.gov/api/views/et5s-xste/rows.csv?accessType=DOWNLOAD")
install.packages("tidyverse")
install.packages("ggplot2")
library("tidyverse")
library("ggplot2")
```


## Look at the structure of the MPDU dataset.

```{r}
str(MPDU)
```

### Look at the head and tail of the MPDU dataset.

```{r}
head(MPDU)
tail(MPDU)
```

### Create new versions of the datasets without NAs.

```{r}
MPDU2 <- drop_na(MPDU)
HLR2 <- drop_na(HLR)
```


### Take a look at the summary of the MPDU dataset.

```{r}
summary(MPDU)
```


### Look at the structure, head, and tail of the HLR dataset.

```{r}
str(HLR)
head(HLR)
tail(HLR)
```




### Take a look at the summary of the HLR dataset.

```{r}
summary(HLR)
```


## Create a new data frame for the MPDU dataset showing just Total Units and Total MPDU, grouped by Planning Area.

```{r}
MPDU$Total.Units <- as.numeric(MPDU$Total.Units)
MPDU$Total.MPDU <- as.numeric(MPDU$Total.MPDU)
MPDU3 <- MPDU %>% 
select(Planning.Area, Total.Units, Total.MPDU) %>%
group_by(Planning.Area)
MPDU3
```

### Drop the NAs from this new data frame.

```{r}
MPDU4 <- drop_na(MPDU3)
```

### Create a new dataframe showing the sums of Total Unit and Total MPDU columns grouped by Planning Area.

```{r}
MPDU5 <- MPDU4 %>% 
    summarize_if(is.numeric, sum)
MPDU5
```

### Create a new data frame with variables of interest from the HLR dataset: Ownership Type, Property City, Structure Type, Unit Count, and License Type.

```{r}
HLR3 <- HLR %>% 
select(Ownership.Type, Property.City, Property.Zip.Code, Structure.Type, Unit.Count, License.Type) %>%
group_by(Property.City)
HLR3
```


## Read in Students Receiving Special Services 2019 dataset.

```{r}
url2 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/378"
download.file(url2, "Special_Services_2019.zip")
unzip("Special_Services_2019.zip")
SS19 <- read.csv("Special_Services_2019.csv")
```

## Read in Students Receiving Special Services 2018 dataset.

```{r}
url5 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/341"
download.file(url5, "Special_Services_2018.zip")
unzip("Special_Services_2018.zip")
SS18 <- read.csv("Special_Services_2018.csv")
```


## Read in Students Receiving Special Services 2017 dataset.

```{r}
url6 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/322"
download.file(url6, "Special_Services_2017.zip")
unzip("Special_Services_2017.zip")
SS17 <- read.csv("Special_Services_2017.csv")
```


## Read in Students Receiving Special Services 2016 dataset.

```{r}
url7 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/298"
download.file(url7, "Special_Services_2016.zip")
unzip("Special_Services_2016.zip")
SS16 <- read.csv("Special_Services_2016.csv")
```


## Read in Students Receiving Special Services 2015 dataset.

```{r}
url8 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/258"
download.file(url8, "Special_Services_2015.zip")
unzip("Special_Services_2015.zip")
SS15 <- read.csv("Special_Services_2015.csv")
```


## Read in Cohort Graduation Rates 2019 dataset.

```{r}
url3 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/390"
download.file(url3, "Cohort_Graduation_and_Dropout_Rates_2019.zip")
unzip("Cohort_Graduation_and_Dropout_Rates_2019.zip")
Grad19 <- read.csv("Cohort_Grad_Rate_2019.csv")
```

## Read in Cohort Graduation Rates 2018 dataset.

```{r}
url9 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/354"
download.file(url9, "Cohort_Graduation_and_Dropout_Rates_2018.zip")
unzip("Cohort_Graduation_and_Dropout_Rates_2018.zip")
Grad18 <- read.csv("Cohort_Grad_Rate_2018.csv")
```


## Read in Cohort Graduation Rates 2017 dataset.

```{r}
url10 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/326"
download.file(url10, "Cohort_Grad_Rate_2017.zip")
unzip("Cohort_Grad_Rate_2017.zip")
Grad17 <- read.csv("Cohort_Grad_Rate_2017.csv")
```


## Read in Cohort Graduation Rates 2016 dataset.

```{r}
url11 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/302"
download.file(url11, "Cohort_Grad_Rate_2016.zip")
unzip("Cohort_Grad_Rate_2016.zip")
Grad16 <- read.csv("Cohort_Grad_Rate_2016.csv")
```


## Read in Cohort Graduation Rates 2015 dataset.

```{r}
url12 <- "https://reportcard.msde.maryland.gov/DataDownloads/FileDownload/262"
download.file(url12, "Cohort_Grad_Rate_2015.zip")
unzip("Cohort_Grad_Rate_2015.zip")
Grad15 <- read.csv("Cohort_Grad_Rate_2015.csv")
```


## Read in Low-Income Housing Tax Credit dataset.

```{r}
url4 <- "https://lihtc.huduser.gov/lihtcpub.zip"
download.file(url4, "lihtcpub.zip")
unzip("lihtcpub.zip")
LIHTC <- read.csv("LIHTCPUB.csv")
```


## Create two data frames: one for MCPS and one for PGCPS with the names of all their respective High Schools with their corresponding zip codes.

```{r}
MCPS <- data.frame(
  MCPS_name = c("Stephen Knolls School", "Longview School", "Montgomery Blair High", "Northwest High", "Walter Johnson High", "Richard Montgomery High", "Gaithersburg High", "Clarksburg High", "Winston Churchill High", "Bethesda-Chevy Chase High", "Quince Orchard High", "Thomas S. Wootton High", "Walt Whitman High", "Wheaton High", "Sherwood High", "Paint Branch High", "John F. Kennedy High", "Albert Einstein High", "Northwood High", "Springbrook High", "James Hubert Blake High", "Watkins Mill High", "Col. Zadok Magruder High", "Rockville High", "Damascus High", "Poolesville High", "Seneca Valley High", "Alternative Programs", "John L Gildner Regional Inst for Children & Adol", "Rock Terrace School"),
  MCPS_zip = c(20895, 20874, 20901, 20874, 20814, 20852, 20877, 20871, 20854, 20814, 20878, 20850, 20817, 20906, 20860, 20866, 20902, 20895, 20901, 20904, 20905, 20879, 20855, 20851, 20872, 20837, 20874, 20853, 20850, 20850)
)
PGCPS = data.frame(
  PGCPS_name = c("Eleanor Roosevelt High","High Point High","Bowie High","Parkdale High","Northwestern High","Dr. Henry A. Wise, Jr. High","Charles Herbert Flowers High","Duval High","Suitland High","Bladensburg High","Laurel High","Oxon Hill High","Potomac High","Frederick Douglass High","Crossland High","Gwynn Park High","Largo High","Central High","Friendly High","Fairmont Heights High","Surrattsville High","Academy of Health Sciences at PGCC","Chesapeake Math and IT Public Charter","International High school @ Largo","Northwestern Evening/Saturday High","International High School @ Langley Park","Chesapeake Math and IT South Public Charter","College Park Academy","Crossland Evening/Saturday High","Tall Oaks High","Croom High","Community Based Classrooms","C. Elizabeth Rieg Regional Center","James E. Duckworth Regional Center"),
  PGCPS_zip = c(20770, 20705, 20715, 20737, 20782, 20772, 20774, 20706, 20746, 20710, 20707, 20745, 20745, 20772, 20748, 20613, 20774, 20747, 20744, 20785, 20735, 20774, 20707, 20772, 20782, 20710, 20772, 20737, 20748, 20721, 20623, 20710, 20716, 20705)
)
MCPS
PGCPS
```

## Rename the Class.of.Year column in Grad15 dataset to match the rest of the Graduation Rate datasets.

```{r}
Grad15 <- Grad15 %>% 
  rename(Academic.Year = Class.of.Year)
```

## Rename the Class.of.Year column in Grad16 dataset to match the rest of the Graduation Rate datasets.

```{r}
Grad16 <- Grad16 %>% 
  rename(Academic.Year = Class.of.Year)
```


## Rename more columns in Graduation Rates datasets to match the rest of them.

```{r}
Grad17 <- Grad17 %>%
  rename(LEA = LEA.Number)
Grad18 <- Grad18 %>%
  rename(LEA = LSS.Number, LEA.Name = LSS.Name)
Grad19 <- Grad19 %>%
  rename(LEA = LSS.Number, LEA.Name = LSS.Name)
```

## Combine all Graduation Rates datasets into one Total Graduation Rate dataset.

```{r}
Total_Grad <- rbind(Grad15, Grad16, Grad17, Grad18, Grad19)
```

## Rename some columns to match the other Students Receiving Special Services datasets and then create new datasets pulling in only the variables I am interested in.

```{r}
SS15_2 <- SS15 %>% 
select(Academic.Year, LEA.Name, School.Name, School.Type, FARMS.Pct, FARMS.Cnt, Enrollment.Cnt)
SS15_2

SS16_2 <- SS16 %>% 
select(Academic.Year, LEA.Name, School.Name, School.Type, FARMS.Pct, FARMS.Cnt, Enrollment.Cnt)
SS16_2

SS17_2 <- SS17 %>% 
select(Academic.Year, LEA.Name, School.Name, School.Type, FARMS.Pct, FARMS.Cnt, Enrollment.Cnt)
SS17_2

SS18_2 <- SS18 %>% 
  rename(LEA.Name = LSS.Name) %>%
  select(Academic.Year, LEA.Name, School.Name, School.Type, FARMS.Pct, FARMS.Cnt, Enrollment.Cnt)
SS18_2

SS19_2 <- SS19 %>% 
  rename(LEA.Name = LSS.Name) %>%
  select(Academic.Year, LEA.Name, School.Name, School.Type, FARMS.Pct, FARMS.Cnt, Enrollment.Cnt)
SS19_2
```

## Combine all Students Receiving Special Services datasets into one Total Special Services dataset.

```{r}
Total_SS <- rbind(SS15_2, SS16_2, SS17_2, SS18_2, SS19_2)
```


## Count NAs for Total_SS and Total_Grad datasets

```{r}
summary(Total_Grad)
```

```{r}
summary(Total_SS)
```

### Great, there are no NAs that need to be removed.

## Create a new Total_Grad dataset with only Montgomery and Prince George's county. Then compare graduation rates for MCPS and PGCPS high schools from 2015-2019.

```{r}
Total_Grad_MCPS_PGCPS <- subset(Total_Grad, LEA.Name == "Montgomery" & Cohort == "4-year adjusted cohort" | LEA.Name == "Prince George's" & Cohort == "4-year adjusted cohort")
```


```{r}
Total_Grad_MCPS_PGCPS$Grad.Rate <- as.numeric(Total_Grad_MCPS_PGCPS$Grad.Rate)
```

```{r}
summary(Total_Grad_MCPS_PGCPS)
```


### Find the mean graduation rates by county.

```{r}
mean_grad <- drop_na(Total_Grad_MCPS_PGCPS) %>%
select(LEA.Name, Grad.Rate) %>%
group_by(LEA.Name) %>%
summarise_all(funs(mean))
mean_grad
```
### Make a visualization for graduation rates by county from 2015-2019.

```{r}
plot1<- ggplot(data=Total_Grad_MCPS_PGCPS, aes(x=Academic.Year, y=Grad.Rate, group=LEA.Name)) +
  geom_boxplot()
plot1
```


```{r}
summary(HLR3)
```

```{r}
HLR3$Property.Zip.Code <- as.numeric(HLR3$Property.Zip.Code)
```


```{r}
summary(HLR3)
```

```{r}
HOC_zip <- aggregate(HLR3$Unit.Count, by=list(Category=HLR3$Property.Zip.Code, HLR3$Ownership.Type), FUN=sum)
HOC_zip
```
```{r}
HOC_zip %>% 
  subset(Group.2=='Housing Opportunities Community') %>%
  arrange(desc(x))%>%
  head(10)
```


```{r}
plot2 <- HOC_zip %>% 
  subset(Group.2=='Housing Opportunities Community') %>%
  arrange(desc(x))%>%
  head(10)%>%
ggplot(HOC_zip, mapping = aes(x=Category, y=x, color=Group.2)) +
  geom_bar(stat="identity", fill="white")
plot2
```



```{r}
MCPS_top10_HOC <- MCPS$MCPS_zip == 20886 | 20814| 20910| 20902| 20874| |20904
```

